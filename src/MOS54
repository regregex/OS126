; MOS54
 TTL MOS54         SPEECH DRIVING
 OPT MOS54
;(c) 1981 ACORN Computers Limited
;BBC Microcomputer Machine Operating System (MOS)
;Change record:
;004 07-Nov-81 PBM    Prototype version
;Author(s):
;Paul Bond


SRINIT  ;initialise SEROM environment for CFS
 ; $EE13
 LDAIM &00-&01 ;$01 adjusts for future INC SEROM
; SEROM will cycle $F0 ... $FF ... $00 ... $10 (max)
 STA SEROM


SRNEXT  ;move on to next SEROM
;
; scans phrase ROM first, then paged ROM
;
SPCPYF  ;entry point from failed copyright message test
 LDXIM SVISFS
 INC SEROM
 LDY SEROM
 [ TRUE = &00
 ; $EE1E
 CPYIM NROM ;if we get here with SEROM >= NROM,
 BCC SPSV ;then no paged ROM is to respond
 RTS ;so exit
 ]


RDSPCH  ;read byte from SEROM
 LDXIM SVRSFS
 ; $EE55
;
; reading from paged ROM
;
 LDYIM  0-MCVER ;enter paged ROM with M/C indicator in Y
;
SPSV  ;used by read byte routine, V not altered
 PHP
 JSR SVOP ;search for paged SEROM (N.B. SVOPSP)
;
 PLP ;restore V-flag
 CMPIM &01 ;claimed => C=0,  not claimed => C=1
 TYA ;A := read character (useful for read byte routine only)
 RTS


 ; $EE62
 ;NB Modified to preserve SRSKIP


SRSKIP  ;skip to SEROM pointer indicated by SRPTR
 LDA SRPTR+&00
 STA ROMPTR+&00
 LDA SRPTR+&01
 STA ROMPTR+&01
 RTS


 [ FALSE=0
; historic code - ignore
 LDY ROMID
 EORIM &0F
 JSR STAROM
 LDXIM ZERO
 LDAIX ROMPTR
 STY ROMID
 STY ROM
 INC ROMPTR+&00
 BNE S1
 INC ROMPTR+&01
S1
 ]


 < &0001


 LNK MOS56
